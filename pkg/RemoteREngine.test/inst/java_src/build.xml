<?xml version="1.0"?>
<project default="all" name="RemoteREngine.test">

	<property file="build.properties"/>
	
	<taskdef resource="testngtasks" classpath="${jdk15.testing.jar}" />
  
	<r-set property="client.jar">
		system.file( "java", "RemoteREngine-client.jar", 
			package = "RemoteREngine" )
	</r-set>

	<path id="project.classpath">
		<pathelement location="${client.jar}" />
		<pathelement location="${jdk15.testing.jar}" />
	</path>
	
	<target name="compile">
		
		<mkdir dir="build" />
		<javac
			destdir="${build.dir}"  
			includeJavaRuntime="yes"
			debug="${compiler.debug}"
			debuglevel="${compiler.debuglevel}"
			optimize="${compiler.optimize}"
			deprecation="${compiler.deprecation}"
			verbose="${compiler.verbose}"
			nowarn="${compiler.nowarn}"
			target="${compiler.target}"
			source="${compiler.source}">
  
			<src path="src" />
			<include name="**/*.java"/>
			<classpath refid="project.classpath" />
		</javac>
	</target>
	          
	<target name="build">
		<jar jarfile="${inst.dir}/RemoteREngine-test.jar">
			<fileset dir="${build.dir}" />
		</jar>
	</target>
	
	<!--
	<path id="testng.classpath">
		<dirset dir="${build.dir}">
			<include name="*" />
			<exclude name="testng_reports"/>
		</dirset>
		<pathelement location="lib/REngine.jar" />
	</path>
	
	<target name="setup.rmicodebase" description="Build codebase for TestNG tests to use class files" >
		  <pathconvert targetos="unix" property="rmicodebase" refid="testng.classpath" >
			<map from="C:" to="file:/c:" />
	    	<map from="D:" to="file:/d:" />
			<map from="E:" to="file:/e:" />
			<map from="F:" to="file:/f:" />
			<map from="G:" to="file:/g:" />
	    </pathconvert>
	</target>
	<target name="runtests" depends="testng-compile,setup.rmicodebase" description="Run TestNG Unit Tests">
		<testng 
			classpathref="testng.classpath"	
			outputDir="${testng.reports}"
			verbose="2"
			haltonfailure="true">
			<jvmarg value="-Djava.security.policy=../policy/server.policy" />
			<jvmarg value="-Djava.rmi.server.codebase=${rmicodebase}" />
			<classfileset dir="${testng.build}" includes="**/*.class" />
		</testng>
	</target>
	-->
	
	
	<target name="all" depends="compile,build" />
	
</project>

